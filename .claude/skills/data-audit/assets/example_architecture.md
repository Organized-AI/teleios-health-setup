# Meta Pixel Architecture: Current vs. Ideal

## Current State: Pixel-Only Tracking

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 WEB BROWSER                      â”‚
â”‚                                                  â”‚
â”‚  User â†’ Website â†’ Meta Pixel (Client-Side)      â”‚
â”‚                        â”‚                         â”‚
â”‚                        â–¼                         â”‚
â”‚               âš ï¸ 30-40% iOS Loss                 â”‚
â”‚               âš ï¸ Ad Blockers                     â”‚
â”‚               âš ï¸ Cookie Consent                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              META ADS PLATFORM                   â”‚
â”‚                                                  â”‚
â”‚  Events Manager                                  â”‚
â”‚  â”œâ”€ Match Quality: 3.5-4.5/10 âš ï¸                â”‚
â”‚  â”œâ”€ Visibility: ~60-70%                         â”‚
â”‚  â””â”€ Missing iOS/blocked conversions             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        âŒ DISCONNECTED âŒ
                        
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CRM (GoHighLevel)                   â”‚
â”‚                                                  â”‚
â”‚  âŒ NOT sending events to Meta                  â”‚
â”‚  âŒ Offline conversions not tracked             â”‚
â”‚  âŒ No attribution back to ads                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ideal State: Hybrid Pixel + CAPI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 WEB BROWSER                      â”‚
â”‚                                                  â”‚
â”‚  User â†’ Website                                  â”‚
â”‚           â”œâ”€â†’ Meta Pixel (Client) + event_id    â”‚
â”‚           â””â”€â†’ Form Data â†’ Backend               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           STAPE SERVER (sGTM)                    â”‚
â”‚                                                  â”‚
â”‚  âœ“ Receives form data                           â”‚
â”‚  âœ“ Enriches with user data (hashed)             â”‚
â”‚  âœ“ Sends to CAPI with event_id                  â”‚
â”‚  âœ“ BYPASSES iOS restrictions                    â”‚
â”‚  âœ“ BYPASSES ad blockers                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CRM (GoHighLevel)                   â”‚
â”‚                                                  â”‚
â”‚  ğŸ”— Webhooks â†’ Stape â†’ CAPI âœ“                   â”‚
â”‚                                                  â”‚
â”‚  CRM Events NOW Tracked:                        â”‚
â”‚  â”œâ”€ Appointment Booked â†’ Schedule               â”‚
â”‚  â”œâ”€ Appointment Completed â†’ CompleteRegistrationâ”‚
â”‚  â”œâ”€ Deal Won â†’ Purchase (with full value!)      â”‚
â”‚  â””â”€ Referral â†’ Custom event                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              META ADS PLATFORM                   â”‚
â”‚                                                  â”‚
â”‚  Events Manager (ENHANCED!)                     â”‚
â”‚  â”œâ”€ Receiving from TWO sources                  â”‚
â”‚  â”‚   1. Browser Pixel (60-70%)                  â”‚
â”‚  â”‚   2. CAPI Server (100%)                      â”‚
â”‚  â”‚   = Deduplication = 100% visibility!         â”‚
â”‚  â”‚                                               â”‚
â”‚  â”œâ”€ Match Quality: 7.0-8.5/10 âœ“                 â”‚
â”‚  â”œâ”€ Attribution: +30-40% recovered              â”‚
â”‚  â””â”€ Revenue: Complete tracking                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Event Deduplication Flow

```
BROWSER PIXEL                    SERVER CAPI
     â”‚                               â”‚
     â–¼                               â–¼
{                               {
  event_name: "Lead",            event_name: "Lead",
  event_id: "lead_12345",        event_id: "lead_12345",  â† SAME
  user_data: {                   user_data: {
    fbp: "fb.1.xxx"                em: "hashed_email",
  }                                ph: "hashed_phone",
}                                   fn: "hashed_name",
     â”‚                               fbp: "fb.1.xxx",
     â”‚                               external_id: "crm_54321"
     â”‚                             }
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
         META DEDUPLICATION
                â”‚
                â–¼
        1 Lead counted
        Best quality data kept
        Both sources credited
```

---

## Expected Improvements

| Metric | Before CAPI | After CAPI | Improvement |
|--------|-------------|------------|-------------|
| Match Quality | 3.5-4.5 | 7.0-8.5 | +100% |
| Visibility | 60-70% | 95-100% | +40% |
| iOS Recovery | 0% | 100% | Complete |
| CRM Events | None | All | Complete |
| Revenue Tracking | Partial | Full | Complete |
